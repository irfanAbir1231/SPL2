<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Set Notification Time</title>
</head>
<body>
  <h1>Set Notification Time</h1>
  <form id="notificationForm">
    <label for="breakfastStartTime">Breakfast Start Time:</label>
    <input type="time" id="breakfastStartTime" name="breakfastStartTime" required><br><br>
    <label for="breakfastEndTime">Breakfast End Time:</label>
    <input type="time" id="breakfastEndTime" name="breakfastEndTime" required><br><br>
    
    <label for="lunchStartTime">Lunch Start Time:</label>
    <input type="time" id="lunchStartTime" name="lunchStartTime" required><br><br>
    <label for="lunchEndTime">Lunch End Time:</label>
    <input type="time" id="lunchEndTime" name="lunchEndTime" required><br><br>
    
    <label for="dinnerStartTime">Dinner Start Time:</label>
    <input type="time" id="dinnerStartTime" name="dinnerStartTime" required><br><br>
    <label for="dinnerEndTime">Dinner End Time:</label>
    <input type="time" id="dinnerEndTime" name="dinnerEndTime" required><br><br>
    
    <label for="notificationTime">Notification Sending Time:</label>
    <input type="time" id="notificationTime" name="notificationTime" value="22:00" required><br><br>
    
    <button type="submit">Submit</button>
  </form>

  <div id="message"></div>

  <script>
    // Ensure DOM content is loaded before attaching event listener
    document.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById('notificationForm');
      
      // Check if form exists
      if (form) {
        form.addEventListener('submit', async function(event) {
          event.preventDefault();
          
          const formData = new FormData(this);
          const breakfastStartTime = formData.get('breakfastStartTime');
          const breakfastEndTime = formData.get('breakfastEndTime');
          const lunchStartTime = formData.get('lunchStartTime');
          const lunchEndTime = formData.get('lunchEndTime');
          const dinnerStartTime = formData.get('dinnerStartTime');
          const dinnerEndTime = formData.get('dinnerEndTime');
          const notificationTime = formData.get('notificationTime');
  
          console.log('Form submitted'); // Add this line to log the form submission
  
          try {
            const response = await fetch('/set_notification', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({ 
                breakfastStartTime, 
                breakfastEndTime, 
                lunchStartTime, 
                lunchEndTime, 
                dinnerStartTime, 
                dinnerEndTime, 
                notificationTime 
              })
            });
  
            if (!response.ok) {
              throw new Error('Failed to set notification');
            }
  
            document.getElementById('message').innerHTML = 'Notification settings saved successfully';
          } catch (error) {
            console.error('Error:', error);
            document.getElementById('message').innerHTML = 'An error occurred while setting notification';
          }
        });
      } else {
        console.error('Form not found');
      }
    });
  </script>
  
</body>
</html>
